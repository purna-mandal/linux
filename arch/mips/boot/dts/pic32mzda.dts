/dts-v1/;
#include <dt-bindings/interrupt-controller/microchip,pic32mz-evic.h>
#include <dt-bindings/input/input.h>
#include "pic32mzda-clk.dtsi"
#include "pic32mzda-pinctrl.dtsi"
#include "pic32mzda-uart.dtsi"
#include "pic32mzda-timer.dtsi"
#include "pic32mzda-i2c.dtsi"
#include "pic32mzda-i2s.dtsi"
#include "pic32mzda-oc.dtsi"

/ {
	#address-cells = <1>;
	#size-cells = <1>;
	compatible = "microchip,pic32mzda";
	model = "Microchip PIC32MZDA";
	interrupt-parent = <&evic>;

	aliases {
		usb1 = &usb1;
		usb1_phy = &usb1_phy;
	};

	cpus {
		cpu@0 {
			compatible = "mips,mips14KEc";
		};
	};

        memory {
                device_type = "memory";
                reg = <0x08000000 0x08000000>;
        };

	chosen {
		bootargs = "console=ttyS1,115200n8";
	};

	evic: interrupt-controller@bf810000 {
		compatible = "microchip,evic-v2";
		interrupt-controller;
		#interrupt-cells = <3>;
		reg = <0xbf810000 0x1000>;
		device_type="evic-v2";
	};

        /* 32-bit class-b timer */
        PBTIMER23:pbtimer23 {
                #timer-cells = <0>;
                compatible = "microchip,pic32-timer";
                reg = <0xbf840200 0x400>;
                interrupts = <TIMER3 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>;
                clocks = <&PBCLK3>, <&TxCKI>;
                timer-id = <2>;
                microchip,timer-32bit;   /* class B, 32-bit combined timer */
        };

        /* 16-bit class-b timer */
        PBTIMER4:pbtimer4 {
                #timer-cells = <0>;
                compatible = "microchip,pic32-timer";
                reg = <0xbf840600 0x200>;
                interrupts = <TIMER4 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>;
                clocks = <&PBCLK3>, <&TxCKI>;
                timer-id = <4>;
        };

	rtc0@bf8c0000 {
		compatible = "microchip,pic32-rtc";
		reg = <0xbf8c0000 0x60>;
		interrupts = <REAL_TIME_CLOCK DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>;
		clocks = <&PBCLK6>;
	};

	pic32_ether: ethernet@bf882000 {
		compatible = "microchip,pic32-ether";
		reg = <0xbf882000 0x1000>, <0x1000 0x7f000>;
		reg-names = "regs","mem";
		interrupts = <ETHERNET_INTERRUPT DEFAULT_INT_PRI IRQ_TYPE_LEVEL_HIGH>;
		phy-mode = "rmii";
		mac-address = [00 00 00 00 00 00];
		clock-names = "eth_clk";
		clocks = <&PBCLK5>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_eth0>;
		reset-gpio = <&pioJ 15 0>;
		status = "ok";
	};

	watchdog: wdt@bf800800 {
		compatible = "microchip,pic32-wdt-v2";
		reg = <0xbf800800 0x200>;
		clocks = <&LPRC>;
	};

	watchdog2: dmt@bf800a00 {
		compatible = "microchip,pic32-dmt";
		reg = <0xbf800a00 0x80>;
		clocks = <&PBCLK7>;
	};

	rng0: rng@bf8e6000 {
		compatible = "microchip,pic32-rng";
		reg = <0xbf8e6000 0x1000>;
		clocks = <&PBCLK5>;
	};

	dma: dma-controller@bf811000 {
		compatible = "microchip,pic32-dma";
		reg = <0xbf811000 0x2000>;
		interrupts = <DMA_CHANNEL_0 INT_PRI(3,0) IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_1 INT_PRI(3,0) IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_2 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_3 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_4 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_5 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_6 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
			<DMA_CHANNEL_7 DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>;
		#dma-cells = <1>;
	};

	sound0 {
		compatible = "microchip,snd-pic32-proto";

		microchip,cpu-dai = <&i2s1 &i2s1>;
		microchip,audio-codec = <&wm8731>;
	};

        /* AHB:   base virtual address: 0xbf8e_0000 : _ffff
         * SDIOC: base virtual address:       _c000 : _cfff
         * ! Bus matrix - AHB address range.
         */
        sdhci@bf8ec000 {
                compatible = "microchip,pic32-sdhci";
                reg = <0xbf8ec000 0x100>;
                interrupts = <SDHC_EVENT DEFAULT_INT_PRI IRQ_TYPE_LEVEL_HIGH>;
                /* TODO?: bus width and Shared Bus configs. */
                /* change to SDHCLK */
                clocks = <&REFCLKO4>;
        };

	lcd0: fb@bf8ea000 {
                compatible = "microchip,pic32-lcd";
                reg = <0xbf8ea000 0x1000>;
		interrupts = <GLCD_INTERRUPT DEFAULT_INT_PRI IRQ_TYPE_LEVEL_HIGH>;
		bits-per-pixel = <32>;
		pic32,transp-length = <0>;
		pic32,red-offset = <16>;
		pic32,grayscale = <0>;
		clocks = <&REFCLKO5>, <&SYSCLK>;
		clock-names = "lcd_clk", "sys_clk";

		display-timings {
			native-mode = <&timing0>;
			timing0: 480x272 {
				pixclock = <40000000>;
				clock-frequency = <40000000>;
				hactive = <480>;
				vactive = <272>;
				hfront-porch = <1>;
				hback-porch = <42>;
				hsync-len = <2>;
				vback-porch = <40>;
				vfront-porch = <21>;
				vsync-len = <23>;
			};
		};
	};

	usb1: usb@bf8e3000 {
		compatible = "microchip,pic32-usb";
		reg = <0xbf8e3000 0x1000>,
		      <0xbf884000 0x1000>;
		reg-names = "mc";
		interrupts = <USB_GENERAL_EVENT DEFAULT_INT_PRI IRQ_TYPE_EDGE_RISING>,
				<USB_DMA_EVENT DEFAULT_INT_PRI IRQ_TYPE_LEVEL_HIGH>;
		interrupt-names = "mc", "dma", "over_current";
		dr_mode = "host";
		mentor,multipoint = <1>;
		mentor,num-eps = <8>;
		mentor,ram-bits = <11>;
		mentor,power = <500>;
		microchip,fifo-mode = <1>;
		phys = <&usb1_phy>;
		clocks = <&PBCLK5>;
		clock-names = "usb_clk";
		/*clock-frequency = <24000000>;*/
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_usb1_vbus>;

		/* VBUS_ON */
		vbus_on-gpios = <&pioB 5 0>;

		usb_overcurrent@0 {
			interrupt-parent = <&pioB>;
			interrupts = <11 PIC32_CN_FALLING>; /* GPIO_B_11 */
		};
	};
	usb1_phy: hsusb1_phy@0 {
		compatible = "usb-nop-xceiv";
		reg = <0xbf8e4000 0x1000>;
		clocks = <&UPLL>;
		clock-names = "main_clk";
		clock-frequency = <24000000>;
	};

	gpio-keys {
                compatible = "gpio-keys-polled";
                pinctrl-0 = <&user_buttons_s0>;
                pinctrl-names = "default";
		poll-interval = <500>;

                power-button {
                        /* On the back */
			label = "Power Button";
                        linux,code = <KEY_POWER>;
                        gpios = <&pioB 12 GPIO_ACTIVE_HIGH>;
                };
        };


	leds {
                pinctrl-names = "default";
                pinctrl-0 = <&user_leds_s0>;

                compatible = "gpio-leds";

                led@1 {
                        label = "pic32mz:red:heartbeat";
                        gpios = <&pioH 0 GPIO_ACTIVE_HIGH>;
                        linux,default-trigger = "heartbeat";
                        default-state = "off";
                };

                led@2 {
                        label = "pic32mz:yellow:led2";
                        gpios = <&pioH 1 GPIO_ACTIVE_HIGH>;
                        default-state = "on";
                };

                led@3 {
                        label = "pic32mz:green:led3";
                        gpios = <&pioH 2 GPIO_ACTIVE_HIGH>;
                        default-state = "on";
                };

	};

	i2c2: i2c2@gpio {
                #address-cells = <1>;
		#size-cells = <0>;
		status = "okay";

		wm8731: wm8731@1a {
                        compatible = "wlf,wm8731";
                        reg = <0x1a>;
                };

		ak4953a: ak4953a@12 {
			compatible = "asahi-kasei,ak4953a";
			reg = <0x12>;
			reset-gpio = <&pioH 3 0>;
		};
	};

	adc1: adc@bf84b000 {
		compatible = "microchip,pic32-adc";
		reg = <0xbf84b000 0x300>;
		interrupts = <ADC1_GLOBAL DEFAULT_INT_PRI IRQ_TYPE_LEVEL_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_adc1>;
		enabled-channel-mask = <0x10000000>;
		resolution = <12>;
		vref = <3300>;

		trigger@0 {
				trigger-name = "int0-external-interrupt";
				trigger-value = <4>;
		};

		trigger@1 {
				trigger-name = "tmr1-match";
				trigger-value = <5>;
				microchip,timer = <&PBTIMER1>;
		};

		trigger@2 {
				trigger-name = "tmr3-match";
				trigger-value = <6>;
				microchip,timer = <&PBTIMER23>;
		};

		trigger@3 {
				trigger-name = "tmr5-match";
				trigger-value = <7>;
				microchip,timer = <&PBTIMER5>;
		};
	};

	pwm_1 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>; /* pbtimer phandle */
		microchip,ocmp = <&OCMP1>; /* ocmp phandle */
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc1>;
		status = "ok";
	};

	pwm_2 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP2>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc2>;
		status = "ok";
	};

	pwm_3 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP3>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc3>;
		status = "ok";
	};

	pwm_4 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP4>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc4>;
		status = "ok";
	};

	pwm_5 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP5>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc5>;
		status = "ok";

	};

	pwm_6 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP6>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc6>;
		status = "disabled";
	};

	pwm_7 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP7>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc7>;
		status = "ok";
	};

	pwm_8 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP8>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc8>;
		status = "disabled";
	};

	pwm_9 {
		compatible = "microchip,pic32-pwm";
		microchip,timer = <&PBTIMER23>;
		microchip,ocmp = <&OCMP9>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_oc9>;
		status = "disabled";
	};

};
